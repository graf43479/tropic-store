@model WebUI.Models.LoginViewModel



@{
    if (Session["attempt"] == null)
    {
        Session["attempt"] = 0;
    @*    TempData["attempt"] = TempData.Peek("attempt");*@
    }
    else
    {
        @*TempData["attempt"] = TempData.Peek("attempt");*@
    }
}
<div class="modal" id="stack1" tabindex="-1" data-focus-on="input:first">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <div class="heading" style="margin-top: 20px; margin-bottom: 0;">
                    <h2 id="myModalLabel">Авторизация </h2>
                    <div id="loadingElement" style="display: none"><i class="fa fa-spinner fa-spin" ></i></div>
                    </div>
            </div>
            <div class="modal-body container-fluid">
                @*  @using (Html.BeginForm("AjaxUserEnter", "Account", FormMethod.Post, new
                    {
                        @class = "form-horizontal",
                        Id = "updateLoginForm"
                    }))*@
                    
                    
@using (Ajax.BeginForm("AjaxUserEnter", "Account", null, new AjaxOptions
{
    UpdateTargetId = "update-message",
    InsertionMode = InsertionMode.Replace,
    HttpMethod = "POST",
    OnBegin = "gifLoaderBefore",
    OnFailure = "gifLoaderAfter",
    OnComplete = "gifLoaderAfter",
    OnSuccess = "updateSuccess",
}, new { @id = "updateLoginForm" }))
{
    
                    @Html.ValidationSummary(true)
                    
                        
                            <div id="update-message" class="error invisible"></div>
                            <div class="form-group has-feedback">
                                <label class="control-label">Логин:</label> 
                                <div class="">
                                    @Html.TextBoxFor(x => x.Login, new {@class = "form-control" }) 
                                    <span class="glyphicon glyphicon-pencil form-control-feedback"></span>
                                    @*<p class="help-block">Введите логин</p>*@
                                    @Html.ValidationMessageFor(x => x.Login)
                                </div>
                            </div>
                
                            <div class="form-group has-feedback">
                                <label class="control-label" for="Password">Пароль:</label> 
                                <div class="controls">
                                    @Html.PasswordFor(x => x.Password, new { @class = "form-control" }) 
                                    <span class="glyphicon glyphicon-pencil form-control-feedback"></span>
                                    @Html.ValidationMessageFor(x => x.Login)
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="editor-label">@Html.CheckBoxFor(x => x.RememberMe) Запомнить меня</div>
                            </div>
                        
                    
               
    
         @*   <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
            <button class="btn btn-primary" id="LoginButton">Login</button>*@
    
    @*<p><input type="checkbox" name="RememberMe" value="true" checked="checked" />Запомнить меня</p>
    <input type="submit" class="actionButtons" value="Вход"/>*@
}
            </div>
    
            <div class="modal-footer">
            
                @*@Html.ActionLink("Забыли пароль?", "ForgottenPassword", "Account", new { @class = "send-email btn btn-success btn-md" }) 
                <button class="btn  send-email" id="LoginButton">Забыли пароль?</button>*@
                
                <div class="btn-group">
                <div class="btn btn-default" style=""><a href="http://oauth.vk.com/authorize?client_id=4522845&scope=email&redirect_uri=http://tropic-store.ru/Account/VkAuth/vk-auth/&response_type=code" title="Зайти через ВКонтакте"><i class="fa  fa-vk"></i></a></div>
                <div class="btn btn-default" style=""><a href="https://www.facebook.com/dialog/oauth?client_id=698808393488449&redirect_uri=http://tropic-store.ru/Account/FbLogin/fblogin/&response_type=code" title="Зайти через Facebook"><i class="fa fa-facebook"></i></a></div>
                
                
                <div class="btn btn-custom send-email">Забыли пароль?</div>

                @Html.ActionLink("Регистрация", "RegistrateUser", "Account", new { @class = "btn btn-custom btn-md" })
                
                @*<i class="fa fa-spinner fa-spin" ></i>*@
                <button class="btn btn-custom" data-dismiss="modal" id="closeButton" aria-hidden="true">Закрыть</button>
                <button class="btn btn-custom" id="LoginButton">Войти</button>
                    @*  <button class="demo btn btn-primary btn-large" data-toggle="modal" href="#stack2">View Demo</button>
              <button class="btn" data-toggle="modal" href="#stack2">Launch modal</button>*@
              </div>
            </div>
        </div>
    </div>
</div>

<div id="updateDialog4" title="Смена пароля"></div>

@*rc="@Url.Content("~/Scripts/js/common2.js")"*@






@*
<script>
    $("#LoginButton").click(function()
    {
        $("#loadingElement").css('display', 'inline');
    });

    function LoadingElementInterrupt() {
        $("#loadingElement").css('display', 'none');
    }
</script>
*@


<script type="text/javascript">

    /*    $("#tmps").click(function (e) {
    e.preventDefault();
    var form = $("#updateAccountEditForm")
    .removeData("validator")
    .removeData("unobtrusiveValidation");
    alert('!!');
    $.validator.unobtrusive.parse(form);


    $.validator.unobtrusive.parse($("#contact-add-popup"));

    if ($('#contact-add-popup').valid()) {
    alert('AJAX');
    }
    });*/

    $('#updateAccountEditForm').on('shown', function () {
        $("#updateLoginForm").removeData("validator");
        $("#updateLoginForm").removeData("unobtrusiveValidation");
        $.validator.unobtrusive.parse("#updateAccountEditForm");
    });

    $('#LoginButton').click(function (e) {
        e.preventDefault();

        $.validator.unobtrusive.parse($("#updateLoginForm"));

        if ($('#updateLoginForm').valid()) {
            //alert('AJAX');
        }
    }); 

</script>

@*
<div id="stack2" class="modal hide fade" tabindex="-1" data-focus-on="input:first">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3>Stack Two</h3>
  </div>
  <div class="modal-body">
    <p>One fine body…</p>
    <p>One fine body…</p>
    <input type="text" data-tabindex="1" />
    <input type="text" data-tabindex="2" />
    <button class="btn" data-toggle="modal" href="#stack3">Launch modal</button>
  </div>
  <div class="modal-footer">
    <button type="button" data-dismiss="modal" class="btn">Close</button>
    <button type="button" class="btn btn-primary">Ok</button>
  </div>
</div>

<div id="stack3" class="modal hide fa" tabindex="-1" data-focus-on="input:first">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h3>Stack Three</h3>
  </div>
  <div class="modal-body">
    <p>One fine body…</p>
    <input type="text" data-tabindex="1" />
    <input type="text" data-tabindex="2" />
  </div>
  <div class="modal-footer">
    <button type="button" data-dismiss="modal" class="btn">Close</button>
    <button type="button" class="btn btn-primary">Ok</button>
  </div>
</div>

*@
  
  
<script>
    $(function(data) {
        if (data.isValid) {
            $('#edit_producer').modal('hide');
            if (data.isNew) {
                AppendToDropDownList(data.name, data.id, 'ProducerId');
            } else {
                EditDropDownListItem(data.name, data.id, 'ProducerId');
            }
        } else {
            $('#edit_producer').html(data.partialView);
        }
    })
</script>
  
  

<script type="text/javascript">
    var linkObj4;
    $(function () {
        $('#updateDialog4').dialog({
            autoOpen: false,
            width: 250,
            resizable: false,
            modal: true,
            buttons: {
                "OK": function () {
                    $("#update-message4").html('');
                    $("#updateEmailForm").submit();
                },
                "Отмена": function () {
                    $(this).dialog("close");
                }
            }
        });

        $(".send-email").click(function () {
            linkObj4 = $(this);
            var dialogDiv = $('#updateDialog4');
            //data-dismiss="modal" aria-hidden="true"
            //$('#stack1')["aria-hidden"] = true;
            $("#closeButton").click();
            
            var viewUrl = "Account/ForgottenPassword"; //linkObj4.attr('href');
            $.get(viewUrl, function (data) {
                dialogDiv.html(data);
                var $form = $("#updateEmailForm");
                $form.unbind();
                $form.data("validator", null);
                $.validator.unobtrusive.parse(document);
                dialogDiv.dialog('option', 'z-index', '1000');
                dialogDiv.dialog('open');
                //dialogDiv.dialog('');
            });
            return false;
        });
    });

    function updateSuccess4(data) {
        if (data.Success == true) {
            alert('На указанный адрес был выслан новый пароль!');
            $('#updateDialog4').dialog('close');
        }
        else {
            $("#update-message4").html(data.ErrorMessage);
            $("#update-message4").show();
        }
    }
</script>





    <script language="javascript" type="text/javascript">
      
    </script>